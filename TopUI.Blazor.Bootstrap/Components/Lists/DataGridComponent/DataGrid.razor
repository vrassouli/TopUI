@namespace TopUI.Blazor.Bootstrap.Components
@using Microsoft.AspNetCore.Components.Web.Virtualization
@using TopUI.Blazor.Bootstrap.Components.Lists.DataGridComponent
@inherits BootstrapComponent
@typeparam TItem
@attribute [CascadingTypeParameter(nameof(TItem))]

<CascadingValue Value="this" IsFixed>
    @Columns

    <div @attributes=AdditionalAttributes>
        <div class="toolbar-content">
            @if (AllowSearch || Toolbar != null)
            {
                <Toolbar Gap="2" FlexWrap="false">
                    @if (AllowSearch)
                    {
                        <InputGroup FlexFill="true">
                            <Addon><i class="bi bi-search"></i></Addon>
                            <TextBox @bind-Value="_searchText" @bind-Value:after="OnSearchChanged" Placeholder="Search..." DisableAutoComplete />
                        </InputGroup>
                    }
                    @if (Toolbar != null)
                    {
                        @Toolbar
                    }
                </Toolbar>
            }
        </div>
        <DataGridHeader TItem="TItem"></DataGridHeader>
        <div class="data-grid-content">
            <Virtualize @ref="_itemsContainer" ItemsProvider="GetItemsProvider">
                <ItemContent>
                    <DataGridRow Item="context" />
                </ItemContent>
                <Placeholder>
                    <DataGridRow TItem="TItem" Placeholder="true" />
                </Placeholder>
            </Virtualize>
        </div>
    </div>
</CascadingValue>
